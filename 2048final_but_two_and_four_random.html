<HTML>
<head>
<style>
font   {color: #723434;}
</style>
</head>
<BODY onload="startup()">
<font size="9"><center><u><b>2048</b></u></center></font>
<P ALIGN="CENTER"><B>INSTRUCTIONS:</B>Use the keys or buttons to control the number board and try to make a 2048.<br>The shortcut for new game is the letter "N".
<p align="center">
<canvas id="myCanvas" width="460" height="460" style="border: 10px solid #d3d3d3; background-color: #f3f3f3;" >hello</canvas>
</p>
<script language="javascript">

function startup(){
var c = document.getElementById("myCanvas");
ctx = c.getContext("2d");
ctx.beginPath();
ctx.moveTo(110,0);
ctx.lineTo(110,460);
ctx.moveTo(230,0);
ctx.lineTo(230,460);
ctx.moveTo(350,0);
ctx.lineTo(350,460);
ctx.moveTo(0,110);
ctx.lineTo(460,110);
ctx.moveTo(0,230);
ctx.lineTo(460,230);
ctx.moveTo(0,350);
ctx.lineTo(460,350);
ctx.lineWidth=8;
ctx.strokeStyle="#d3d3d3";
ctx.stroke();
document.addEventListener("keydown",keyPush);
allPositions = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
allValues = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
score=0;
highscore=0;
/*ctx.fill.Style="white";
ctx.fillRect(random()*120+5,random()*120+5,100,100);
ctx.font = "30px Arial";
ctx.fillText("2",random()*120+55,random()*120+55)*/
randomtwo();
}

function randomonlytwo(){
var rt = Math.floor(Math.random()*4);
return (rt)
}

function random(){
var x = Math.floor(Math.random()*4);
return (x)
}

function randomtwo(){  //actually 2 and 4
var m = random();
var y = random();
if (allPositions[y*4+m]==1){
randomtwo();
}else{
if (randomonlytwo()<3){
ctx.fillStyle="#fcf0ff";
ctx.fillRect(m*120+5,y*120+5,100,100);
ctx.fillStyle="black";
ctx.font = "30px Arial";
ctx.fillText("2",m*120+55,y*120+55);
allPositions[y*4+m]=1;
allValues[y*4+m]=2;
}else{
ctx.fillStyle="#f5cffe";
ctx.fillRect(m*120+5,y*120+5,100,100);
ctx.fillStyle="black";
ctx.font = "30px Arial";
ctx.fillText("4",m*120+55,y*120+55);
allPositions[y*4+m]=1;
allValues[y*4+m]=4;
}
}
}

function helperforupdown(){   //everything actually
for(var x=0;x<4;x++){
for(var y=0;y<4;y++){
if (allPositions[y*4+x]==0){
ctx.clearRect(x*120+5,y*120+5,100,100)
}else{
switch(allValues[y*4+x]){
case 0:
break;
case 2:
  ctx.fillStyle="#fcf0ff";
  ctx.fillRect(x*120+5,y*120+5,100,100);
  ctx.fillStyle="black";
  ctx.font = "30px Arial";
  ctx.fillText("2",x*120+50,y*120+55);
  break;
case 4:          //tester ,remove later
  ctx.fillStyle="#f5cffe";
  ctx.fillRect(x*120+5,y*120+5,100,100);
  ctx.fillStyle="black";
  ctx.font = "30px Arial";
  ctx.fillText("4",x*120+50,y*120+55);
  break;
case 8:          //tester ,remove later
  ctx.fillStyle="#eeb0fc";
  ctx.fillRect(x*120+5,y*120+5,100,100);
  ctx.fillStyle="black";
   ctx.font = "30px Arial";
  ctx.fillText("8",x*120+50,y*120+55);
  break;
case 16:          //tester ,remove later
    ctx.fillStyle="#ea98fd";
    ctx.fillRect(x*120+5,y*120+5,100,100);
    ctx.fillStyle="black";
    ctx.font = "30px Arial";
    ctx.fillText("16",x*120+37,y*120+55);
  break;
  case 32:          //tester ,remove later
      ctx.fillStyle="#e57dfe";
      ctx.fillRect(x*120+5,y*120+5,100,100);
      ctx.fillStyle="black";
      ctx.font = "30px Arial";
      ctx.fillText("32",x*120+37,y*120+55);
  break;
  case 64:          //tester ,remove later
      ctx.fillStyle="#e164ff";
      ctx.fillRect(x*120+5,y*120+5,100,100);
      ctx.fillStyle="black";
      ctx.font = "30px Arial";
      ctx.fillText("64",x*120+37,y*120+55);
  break;
  case 128:          //tester ,remove later
        ctx.fillStyle="#db4dfd";
        ctx.fillRect(x*120+5,y*120+5,100,100);
        ctx.fillStyle="black";
        ctx.font = "30px Arial";
        ctx.fillText("128",x*120+20,y*120+55);
  break;
  case 256:          //tester ,remove later
        ctx.fillStyle="#d736fe";
        ctx.fillRect(x*120+5,y*120+5,100,100);
        ctx.fillStyle="black";
        ctx.font = "30px Arial";
        ctx.fillText("256",x*120+20,y*120+55);
  break;
  case 512:          //tester ,remove later
        ctx.fillStyle="#d013fe";
        ctx.fillRect(x*120+5,y*120+5,100,100);
        ctx.fillStyle="black";
        ctx.font = "30px Arial";
        ctx.fillText("512",x*120+20,y*120+55);
  break;
  case 1024:          //tester ,remove later
        ctx.fillStyle="#9d04ef";
        ctx.fillRect(x*120+5,y*120+5,100,100);
        ctx.fillStyle="black";
        ctx.font = "30px Arial";
        ctx.fillText("1024",x*120,y*120+55);
  break;
  case 2048:          //tester ,remove later
        ctx.fillStyle="#8f06d8";
        ctx.fillRect(x*120+5,y*120+5,100,100);
        ctx.fillStyle="black";
        ctx.font = "30px Arial";
        ctx.fillText("2048",x*120,y*120+55);
  break;
  }
//later,put the required text of 2,4,8,16 etc. and also combine like ones  too
}
}
}
}

function gravityuparrays(){
for(var x=0;x<4;x++){
var c = 6;
var b = 0;
for(var y=0;y<4;y++){
if(allPositions[y*4+x]==1){
allPositions[y*4+x]=0;
allPositions[b*4+x]=1;
var gist=allValues[y*4+x];
allValues[y*4+x]=0;
allValues[b*4+x]=gist;
b++;
}else {
c++;
}
}
}
}

function mergerup(){
var c=8;
for(var x=0;x<4;x++){
for(var y=0;y<3;y++){
if(allValues[y*4+x]==allValues[y*4+4+x]){
allValues[y*4+x]=(2*allValues[y*4+x]);
score+=(2*allValues[y*4+x]);
document.getElementById("demo").innerHTML = score;
allValues[y*4+4+x]=0;
allPositions[y*4+4+x]=0;
gravityuparrays();
}else{
c++;
}
}
}
}

function gravityup(){
var tek=0;
checker=allPositions.slice(0);
gravityuparrays();
mergerup();
helperforupdown();
gameovercheck();
if(arrayequalcheck(checker,allPositions)!=16){
randomtwo();
}else{tek++}
}

function gravitydownarrays(){
for(var x=3;x>-1;x--){
var c= 6;
var b=3;
for(var y=3;y>-1;y--){
if(allPositions[y*4+x]==1){
allPositions[y*4+x]=0;
allPositions[b*4+x]=1;
var gist=allValues[y*4+x];
allValues[y*4+x]=0;
allValues[b*4+x]=gist;
b--;
}else{
c++;
}
}
}
}

function mergerdown(){
var c=22;
for(var x=3;x>-1;x--){
for(var y=2;y>-1;y--){
if(allValues[y*4+x]==allValues[y*4+4+x]){
allValues[y*4+x]=(2*allValues[y*4+x]);
score+=(2*allValues[y*4+x]);
document.getElementById("demo").innerHTML = score;
allValues[y*4+4+x]=0;
allPositions[y*4+4+x]=0;
gravitydownarrays();
}else{
c++;
}
}
}
}

function gravitydown(){
var tek=0;
checker=allPositions.slice(0);
gravitydownarrays();
mergerdown();
helperforupdown();
gameovercheck();
if(arrayequalcheck(checker,allPositions)!=16){
randomtwo();
}else{tek++}
}

function gravityrightarrays(){
for(var y=0;y<4;y++){
var c=66;
var b=3;
for(var x=3;x>-1;x--){
if (allPositions[y*4+x]==1){
allPositions[y*4+x]=0;
allPositions[y*4+b]=1;
var gist = allValues[y*4+x];
allValues[y*4+x]=0;
allValues[y*4+b]=gist;
b--;
}else{
c++;
}
}
}
}

function gravityleftarrays(){
for(var y=0;y<4;y++){
var c=66;
var b=0;
for(var x=0;x<4;x++){
if (allPositions[y*4+x]==1){
allPositions[y*4+x]=0;
allPositions[y*4+b]=1;
var gist = allValues[y*4+x];
allValues[y*4+x]=0;
allValues[y*4+b]=gist;
b++;
}else{
c++;
}
}
}
}

function mergerleft(){
var c=99;
for(var y=0;y<4;y++){
for(var x=0;x<3;x++){
if(allValues[y*4+x]==allValues[y*4+x+1]){
allValues[y*4+x]=(2*allValues[y*4+x]);
score+=(2*allValues[y*4+x]);
document.getElementById("demo").innerHTML = score;
allValues[y*4+x+1]=0;
allPositions[y*4+x+1]=0;
gravityleftarrays();
}else{
c++;
}
}
}
}

function reset(){
allPositions = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
allValues = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
helperforupdown();
randomtwo();
highscorecheck();
score=0;
document.getElementById("demo").innerHTML = score;
}

function mergerright(){
var c=55;
for(var y=0;y<4;y++){
for(var x=3;x>0;x--){
if(allValues[y*4+x]==allValues[y*4+x-1]){
allValues[y*4+x]=(2*allValues[y*4+x]);
score+=(2*allValues[y*4+x]);
document.getElementById("demo").innerHTML = score;
allValues[y*4+x-1]=0;
allPositions[y*4+x-1]=0;
gravityrightarrays();
}else{
c++;
}
}
}
}

function gravityleft(){
var tek=0;
checker=allPositions.slice(0);
gravityleftarrays();
mergerleft();
helperforupdown();
gameovercheck();
if(arrayequalcheck(checker,allPositions)!=16){
randomtwo();
}else{tek++}
}

function gravityright(){
var tek=0;
checker=allPositions.slice(0);
gravityrightarrays();
mergerright();
helperforupdown();
gameovercheck();
if(arrayequalcheck(checker,allPositions)!=16){
randomtwo();
}else{tek++}
}

function keyPush(evt) {
    switch(evt.keyCode) {
        case 37:
            gravityleft();
            break;
        case 38:
            gravityup();
            break;
        case 39:
            gravityright();
            break;
        case 40:
            gravitydown();
            break;
        case 78:
            reset();
            break;
    }
}

function gameover(){
window.alert("GAMEOVER. Click 'OK' to start a new game.")
//document.removeEventListener("keydown",keyPush)
reset();
}

function zerocheck(){
var cont=0;
var ty=0;
for(var th=0;th<16;th++){
if(allPositions[th]==0){
cont++
}else{ty++}
}
return (cont);
}

function gameovercheck(){
var c=5;
var cot=0;
for(var x=0;x<3;x++){
for(var y=0;y<4;y++){
if(allValues[y*4+x]==allValues[y*4+x+1]){
cot++
}else{c++}
}
}
for(var y=0;y<3;y++){
for(var x=0;x<4;x++){
if(allValues[y*4+x]==allValues[y*4+4+x]){
cot++
}else{c++}
}
}
if(cot==0 && zerocheck()==0){
gameover();
}
}

function highscorecheck(){
if (score>highscore){
highscore=score;
document.getElementById("high").innerHTML = highscore;
}
}

function arrayequalcheck(array1,array2){
var gh=0;
cek=0;
for(var h=0;h<16;h++){
if(array1[h]==array2[h]){
cek++
}else{gh++}
}
return (cek);
}


//make randompiece()
</script>
<center><b>Score:</b></center><p id="demo" align="center"></p>
<P ALIGN="CENTER">
<button onclick="gravityup()">UP</button><BR><br>
<button onclick="gravityleft()">LEFT</button>
<button onclick="gravitydown()">DOWN</button>
<button onclick="gravityright()">RIGHT</button><BR><BR>
<button onclick="reset()">New Game</button>
</P>
<center><b>HighScore:</b></center><p id="high" align="center">N/A</p>
</body>
</html>